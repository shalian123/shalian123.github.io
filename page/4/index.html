<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="Wind" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="记录生活点滴">
<meta property="og:type" content="website">
<meta property="og:title" content="Wind">
<meta property="og:url" content="http://shalian123.github.io/page/4/index.html">
<meta property="og:site_name" content="Wind">
<meta property="og:description" content="记录生活点滴">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Wind">
<meta name="twitter:description" content="记录生活点滴">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>

  <title> Wind </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Wind</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">细节在于观察，成功在于积累。</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/06/03/linux输入登陆密码正确，闪回登陆界面，无法登陆/" itemprop="url">
                  linux输入登陆密码正确，闪回登陆界面，无法登陆
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-06-03T20:13:25+08:00" content="2017-06-03">
              2017-06-03
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/06/03/linux输入登陆密码正确，闪回登陆界面，无法登陆/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/06/03/linux输入登陆密码正确，闪回登陆界面，无法登陆/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近遇到一个头疼的问题，在登陆linux系统时输入密码正确，但却老是闪回登陆界面，无法登陆。我参考了网上的方法，却仍然发现走了一些弯路，主要网上有的解释太过简略或者有点局限，甚至还是错的。在此，我结合我解决的过程，主要做个总结。</p>
<h5 id="产生原因"><a href="#产生原因" class="headerlink" title="产生原因"></a>产生原因</h5><p>问题的原因：主目录下的.Xauthority文件拥有者变成了root，从而以用户登陆的时候无法都取.Xauthority文件 。<br><strong>注意：这里的主目录是你登陆的用户，不是root用户</strong><br><strong>说明：</strong>Xauthority，是<strong>startx</strong>脚本记录文件。Xserver启动时，读文件~/.Xauthority,读入对应其display 的记录。当一个需要显示的客户程序启动调用XOpenDisplay()也读这个文 件，并把找到的magic code 发送给 Xserver。当Xserver验证这个magic code正确以后，就同意连接啦。观察startx脚本也可以看到，每次startx 运行，都在调用xinit以前使用了xauth的add命令添加了一个新的记录到~/.Xauthority，用来这次运行X使用认证。(<strong>注意：一般sudo startx后就这样不能登陆了</strong>)</p>
<h5 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h5><p>1.在需要输入密码的登陆界面，按下ctrl+alt+F1组合键，进入tty1终端<br><img src="http://ols4zt49w.bkt.clouddn.com/1496493167%281%29.png" alt=""><br><img src="http://ols4zt49w.bkt.clouddn.com/1496492971%281%29.png" alt=""><br>2.输入登陆ubuntu时的用户名和密码，在tty1终端出现登陆成功的提示，这里我的用户名是topeet，默认进入当前用户主目录（我的是/home/topeet）,可以用pwd命令查看，若不是，则切换至：<br>cd  或者<br>cd /home/topeet/ 注意：我这里的用户名是topeet,根据自己的实际情况更改。<br><img src="http://ols4zt49w.bkt.clouddn.com/1496493023%281.png" alt=""><br>3.执行命令，将Xauthority的拥有者改为用户topeet<br>$ sudo chown topeet:topeet .Xauthority<br>备注：本人的用户名为topeet，因此 chown后面跟了topeet:topeet若为其他用户名修改成相应的名称即可）<br>(我的用户和用户组都是topeet,如果你不知道可以用<code>more /etc/group</code>及<code>more /etc/passwd</code>查看)<br><img src="http://ols4zt49w.bkt.clouddn.com/1496493060%281.png" alt=""><br>4.然后在终端提示符后输入：$ ls .Xauthority -l<br>正确无误后显示如下：-rw——- 1 topeet topeet 51  May 22 23:14 .Xauthority<br>此时拥有者已经变为用户。<br><img src="http://ols4zt49w.bkt.clouddn.com/1496493097%281.png" alt=""><br>5.按下ctrl + alt + F7切换回图形登陆界面登陆即可。<br><strong>易错点：</strong><br>一开始我是切换到root用户下修改.Xauthority文件的拥有者的，但是试了几次都没成功，在次特别强调按下ctrl+alt+F1组合键，进入tty1终端后登入你想登入的账户，而不是root用户。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/06/02/逐行读写字符串数组到文本txt文件/" itemprop="url">
                  逐行读写字符串数组到文本txt文件
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-06-02T14:31:30+08:00" content="2017-06-02">
              2017-06-02
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/c-c/" itemprop="url" rel="index">
                    <span itemprop="name">c/c++</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/06/02/逐行读写字符串数组到文本txt文件/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/06/02/逐行读写字符串数组到文本txt文件/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在c和c++代码的操作中，我们有时会用到一些文件操作，为了方便以后的调用，我在此总结了一些简单的文件读写操作，并依次展示效果。</p>
<h4 id="C语言方式"><a href="#C语言方式" class="headerlink" title="C语言方式"></a>C语言方式</h4><p>在代码中，主要用到了以下几个头文件：为了方便，此处将几次代码的头文件汇到了一起，你可以直接复制过去。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">#include&lt;iostream&gt; //c++的</div><div class="line">#include&lt;stdio.h&gt;  //c的</div><div class="line">#include&lt;string&gt;</div><div class="line">#include&lt;fstream&gt; //c++文件读写操作函数</div><div class="line">using namespace std;</div></pre></td></tr></table></figure></p>
<h5 id="fprintf-函数将字符串数组写入到txt文件中"><a href="#fprintf-函数将字符串数组写入到txt文件中" class="headerlink" title="fprintf()函数将字符串数组写入到txt文件中"></a>fprintf()函数将字符串数组写入到txt文件中</h5><p>此处的fprintf()函数：输出函数(格式化输出数据至文件)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">   FILE *fp;</div><div class="line">errno_t err;</div><div class="line">char * name[] = &#123; &quot;file1&quot;, &quot;file2&quot;, &quot;file3&quot;, &quot;file4&quot;, &quot;file5&quot; &#125;;</div><div class="line">if((err=fopen_s(&amp;fp,&quot;E://test.txt&quot;, &quot;w&quot;))!=0)</div><div class="line">   printf(&quot;the file was not opened\n&quot;);</div><div class="line">      </div><div class="line">for (int i = 0; i &lt; 5; i++)</div><div class="line">&#123;</div><div class="line">	fprintf(fp, &quot;%s\n&quot;, name[i]);</div><div class="line">&#125;</div><div class="line">   </div><div class="line">fclose(fp);</div></pre></td></tr></table></figure></p>
<p>此处，补充一点知识，在vs里经常遇到：<br><strong>fopen的用法是: fp  = fopen(filename, “w”)。<br>而对于fopen_s来说，还得定义另外一个变量errno_t  err，然后err = fopen_s(&amp;fp, filename, “w”)。<br>返回值的话，对于fopen来说，打开文件成功的话返回文件指针（赋值给fp），打开失败则返回NULL值；<br>对于fopen_s来说，打开文件成功返回0，失败返回非0。</strong></p>
<p>最终效果如图：<br><img src="http://ols4zt49w.bkt.clouddn.com/51N_X%281B6$EIC$W~ORIV%25%7DT.png" alt=""></p>
<h5 id="使用fputs函数逐行写入文本"><a href="#使用fputs函数逐行写入文本" class="headerlink" title="使用fputs函数逐行写入文本"></a>使用fputs函数逐行写入文本</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">   char *InputStr = &quot;that is ok&quot;;</div><div class="line">FILE* fp;</div><div class="line">errno_t err;</div><div class="line">if ((err = fopen_s(&amp;fp, &quot;C://1.txt&quot;, &quot;wt&quot;)) != 0)</div><div class="line">	printf(&quot;the file was not opened\n&quot;);</div><div class="line">//FILE* fp = fopen(&quot;C:\\1.txt&quot;, &quot;wt&quot;);</div><div class="line">//if (fp != NULL)</div><div class="line">//&#123;</div><div class="line">	fseek(fp, 0, SEEK_END);</div><div class="line">	fputs(InputStr, fp);</div><div class="line">	fputs(&quot;\r\n&quot;, fp);</div><div class="line">	fclose(fp);</div><div class="line">//&#125;</div></pre></td></tr></table></figure>
<p>最终效果：<br><img src="http://ols4zt49w.bkt.clouddn.com/M_8VG%5BRJM5%7D%5BPA95%7B6%254V%60A.png" alt=""></p>
<h5 id="利用fscanf对文件进行格式化输入，读取文件中的数据"><a href="#利用fscanf对文件进行格式化输入，读取文件中的数据" class="headerlink" title="利用fscanf对文件进行格式化输入，读取文件中的数据"></a>利用fscanf对文件进行格式化输入，读取文件中的数据</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">   int i = 0;</div><div class="line">FILE *fp;</div><div class="line">fopen_s(&amp;fp,&quot;E://test.txt&quot;, &quot;r&quot;);</div><div class="line">char  name[6][10] = &#123;0&#125;;//如果没有初始化，最后没有读取的几位将会乱码。整个字符数组输出，如未初始化，则没有写入确定值的元素是一些不确定值，输出可能就是一堆乱码了。</div><div class="line"></div><div class="line">while (!feof(fp))</div><div class="line">&#123;</div><div class="line">	fscanf_s(fp, &quot;%s&quot;, name[i],sizeof(name[i]));</div><div class="line">	printf(&quot;%s\n&quot;, name[i]);</div><div class="line">	i++;</div><div class="line">&#125;</div><div class="line">fclose(fp);</div></pre></td></tr></table></figure>
<p><strong>注意：整个字符数组输出，如未初始化，则没有写入确定值的元素是一些不确定值，输出可能就是一堆乱码了。</strong><br>效果如下：<br><img src="http://ols4zt49w.bkt.clouddn.com/K4FYVZ5$%29OIJ@_%6007%7DJ%60~%5B5.png" alt=""></p>
<h4 id="C-语言方式"><a href="#C-语言方式" class="headerlink" title="C++语言方式"></a>C++语言方式</h4><p>在看具体实例前，我先简要介绍一下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">#include &lt;fstream&gt;  </div><div class="line">ofstream         //文件写操作 内存写入存储设备   </div><div class="line">ifstream         //文件读操作，存储设备读区到内存中  </div><div class="line">fstream          //读写操作，对打开的文件可进行读写操作</div></pre></td></tr></table></figure></p>
<p>下面主要列举两个例子，一个是从文件里读取数据，然后控制台输出；另一个是读取一个文件数据，并将数据写入另一个文件，即复制。</p>
<h5 id="c-读文件"><a href="#c-读文件" class="headerlink" title="c++读文件"></a>c++读文件</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">   ifstream in(&quot;E://test.txt&quot;);</div><div class="line">string filename;</div><div class="line">string line;</div><div class="line"></div><div class="line">if (in) // 有该文件</div><div class="line">&#123;</div><div class="line">	while (getline(in, line)) // line中不包括每行的换行符</div><div class="line">	&#123;</div><div class="line">		cout &lt;&lt; line &lt;&lt; endl;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line">else // 没有该文件</div><div class="line">&#123;</div><div class="line">	cout &lt;&lt; &quot;no such file&quot; &lt;&lt; endl;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>效果如下：<br><img src="http://ols4zt49w.bkt.clouddn.com/79%25%25GY~48KKPO%5B3LT%28K%5BO1U.png" alt=""></p>
<h5 id="c-文件间数据的复制"><a href="#c-文件间数据的复制" class="headerlink" title="c++文件间数据的复制"></a>c++文件间数据的复制</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">/*实现读取文件file1，写入到文件file2，实现复制*/</div><div class="line">void fileCopy(char *file1, char *file2)</div><div class="line">&#123;</div><div class="line">	// 最好对file1和file2进行判断</div><div class="line"></div><div class="line">	ifstream in(file1);</div><div class="line">	ofstream out(file2);</div><div class="line">	string filename;</div><div class="line">	string line;</div><div class="line"></div><div class="line">	while (getline(in, line))</div><div class="line">	&#123;</div><div class="line">		out &lt;&lt; line &lt;&lt; endl;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line">int main()</div><div class="line">&#123;</div><div class="line">    fileCopy(&quot;E://1.txt&quot;, &quot;E://2.txt&quot;);</div><div class="line">	return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>效果如下：<br><img src="http://ols4zt49w.bkt.clouddn.com/ZPH%28KD016GH%25HN%7B%7D~5T%28DJM.png" alt=""><br><strong>补充</strong>：这里只是简单的文件操作，关于<strong>c++</strong>的文件读写详解可以参考：<br><strong>C++</strong>文件读写详解（ofstream,ifstream,fstream） <a href="http://blog.csdn.net/kingstar158/article/details/6859379" target="_blank" rel="external">http://blog.csdn.net/kingstar158/article/details/6859379</a><br>里面还包含一些二进制文件，缓存与同步等。<br><strong>扩展：</strong><br>C++的输入输出分为三种：<br>(1)基于控制台的I/O，头文件iostream<br>(2)基于文件的I/O, 头文件fstream<br>(3)基于字符串的I/O,头文件sstream<br>具体参考博客：<a href="http://www.cnblogs.com/gamesky/archive/2013/01/09/2852356.html" target="_blank" rel="external">http://www.cnblogs.com/gamesky/archive/2013/01/09/2852356.html</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/06/01/c-11-新特性/" itemprop="url">
                  c++11新特性
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-06-01T21:50:54+08:00" content="2017-06-01">
              2017-06-01
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/c-c/" itemprop="url" rel="index">
                    <span itemprop="name">c/c++</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/06/01/c-11-新特性/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/06/01/c-11-新特性/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>C++</strong>面试中经常会被问到的一个问题是:了解哪些 C++11 新特性，下面总结几条实用的新特性,注意以下不是全部，只是部分，在以后学习的过程中继续补充。</p>
<h5 id="1-右值的引用"><a href="#1-右值的引用" class="headerlink" title="1.右值的引用"></a>1.右值的引用</h5><p>传统的 <strong>C++</strong> 引用（现在称为左值引用）使标识符关联到左值。左值是一个表示数据的表达式（如变量名或解除引用的指针）。C++11 新增了右值引用，使用 <strong>&amp;&amp; </strong>表示。右值则包括字面常量、诸如 x + y 表达式以及返回值的函数。记住一点，<strong>左值与右值的根本区别在于能否获取内存地址，而能否赋值不是区分的依据</strong>。<br>下面简要总结一下<strong>引用和指针的区别</strong>：<br>两者都是与地址相关的概念。<strong>引用是变量的别名，而指针则是变量的地址</strong><br>区别如下：<br>==1.指针是一个实体（分配内存），而引用仅是个别名；<br>2.引用只能在定义时被初始化一次，之后不可变；指针可变；引用“从一而终”，指针可以“见异思迁”；<br>3.引用没有const，指针有const，const的指针不可变；<br>4.引用不能为空，指针可以为空；<br>5.“sizeof 引用”得到的是所指向的变量(对象)的大小，而“sizeof 指针”得到的是指针本身的大小；<br>从上面可以看出引用更接近 const 指针。==<br>引入右值引用的主要目的之一是实现移动语义，下面展开来谈==</p>
<h5 id="2-移动语句"><a href="#2-移动语句" class="headerlink" title="2.移动语句"></a>2.移动语句</h5><p>为方便理解移动语句，考虑下面的示例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">vector&lt;string&gt; allcpas(const vector&lt;string&gt; &amp;vs)</div><div class="line">&#123;</div><div class="line">    vector&lt;string&gt; temp;</div><div class="line">    // 将 vs 复制给 temp</div><div class="line">    return temp;</div><div class="line">&#125;</div><div class="line">vector&lt;string&gt; vstr;</div><div class="line">// vstr 是包含 20000 个 string 的向量，每个元素有 1000 个字符</div><div class="line">vector&lt;string&gt; vstr_copy1(vstr);</div><div class="line">vector&lt;string&gt; vstr_copy2(allcps(vstr));    // #2</div></pre></td></tr></table></figure></p>
<p>对语句# 2， <code>allcps</code> 将返回值 temp 复制给临时形参变量，再将该形参复制给<code>vstr_copy2</code> 。编译器对 vstr 复制了两次。这样显然很消耗资源。如果将对数据的所有权直接转让给 <code>vstr_copy2</code> ，显然会更好，对此我们只需要实现 vstr_copy2 的<strong>移动构造函数</strong>，在函数内部将调整临时变量的所有权，从而避免一次无意义的复制。移动语义实际上避免了移动原始数据，而只是修改了记录。</p>
<h5 id="3-基于范围的for循环"><a href="#3-基于范围的for循环" class="headerlink" title="3.基于范围的for循环"></a>3.基于范围的for循环</h5><p>对于内置数组已经包含 <code>begin()</code> 和 <code>end()</code> 的类和 STL 容器，基于范围的 for 循环可以简化为它们编写循环的工作。这种循环对数组或容器中的每个元素执行指定的操作：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">std::vector&lt;int&gt; vi(6);</div><div class="line">for (auto &amp;x : vi)</div><div class="line">    x = std::rand()</div></pre></td></tr></table></figure></p>
<p>x 依次为 vi 中的每个元素的引用，从而实现了对数组每个元素的修改。</p>
<h5 id="4-智能指针"><a href="#4-智能指针" class="headerlink" title="4.智能指针"></a>4.智能指针</h5><p>智能指针的出现很自然，其行为类似于指针的类对象，可以在离开对象周期使自动析构函数，释放动态申请的内存。<br>模板 <code>auto_ptr</code> 是 <strong>c++98</strong> 提供的解决方案，C++11 已将其摈弃，并提供了 unique_ptr ，shared_ptr 两种解决方案。<br>智能指针很多方面都类似于常规指针。例如，如果 ps 是一个智能指针对象，则可以对它执行解除引用操作（*ps）、用它来访问结构成员，将他赋值给相同类型的常规指针。将智能指针对象赋值给对另一个同类型的智能指针对象，将引起一个问题。看下面例子：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">auto_ptr&lt;string&gt; ps (new string(&quot;I reigned lonely as a cloud.&quot;));</div><div class="line">auto_ptr&lt;string&gt; vocation;</div><div class="line">vocation = ps;</div></pre></td></tr></table></figure></p>
<p>两个指针指向同一块内存，会造成程序试图删除同一个对象两次。避免这种问题，有如下思路：<br>1.建立所有权的概念，对于特定的指针，只能有一个智能指针对象可以拥有它。让赋值操作转让所有权。这就是用于 auto_ptr 和 unique_ptr 的策略。<br>2.创建智能更高的指针，跟踪引用计数特定对象的智能指针数。这称为引用计数。例如，赋值计数加1，过期时，计数减1。仅当最后一个指针过期时，才调用 delete。这是 shared_ptr 采用的策略。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/18/QT5-3-2连接Mysql老是失败！/" itemprop="url">
                  QT5.3.2连接Mysql老是失败！
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-05-18T17:00:13+08:00" content="2017-05-18">
              2017-05-18
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/QT/" itemprop="url" rel="index">
                    <span itemprop="name">QT</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/05/18/QT5-3-2连接Mysql老是失败！/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/05/18/QT5-3-2连接Mysql老是失败！/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>之前在QT里一直用的文件型数据库sqlite,今天突然想试试在里面连接Mysql，结果却遇到了一个问题，问题如下：<br>在程序运行后，显示的驱动里明明有QMYSQL驱动，同时我也成功创建了一个mydata数据库，但是就是显示加载不了驱动。<br><img src="http://ols4zt49w.bkt.clouddn.com/1495098343%281%29.png" alt=""><br><img src="http://ols4zt49w.bkt.clouddn.com/1495098462%281%29.png" alt=""></p>
<p>网上的解决方案很多，大概有：<br>1.需要自己编译驱动。（qmysql.dlll,qmysqld.dll已经存在）<br>2.将mysql目录下lib中的libmysql.dll考到Qt安装目录bin中。<br>3.将plugins\sqldrivers文件夹拷贝到工程目录及其目标文件中。<br>结果都是一个效果，无效！！！不能不说网上有的回答并不全面或者说是牛头不对马嘴，也因此坑了我一个下午，最终得已解决，在此为了避免你们遇到跟我一样得问题，我在这里总结一下：</p>
<p>1.从Qt5.2版本开始，已经包含了MySQL驱动，不需要在手动编译了。你可以通过qDebug()&lt;&lt;QSqlDatabase::drivers()查看支持的驱动。</p>
<p><strong>2.还有一个很重要的是32位的MySQL对应32位的Qt。</strong></p>
<p>相信你们也发现了，解决方案很简单。由于<strong>我的版本是QT5.3,而且x86的，即32位的</strong>，虽然我的电脑是64位win10系统，但是在<strong>电脑上必须装32位的Mysq</strong>l。相信大家会有疑惑，64位的系统怎么能装32位的软件呢，但是奇葩的是竟然成功装上了，至少 mysql-5.5.27-win32.msi 可以。<br>接下来再将mysql目录下lib中的libmysql.dll考到Qt安装目录bin中。<br>在此编译运行，结果如下：<br><img src="http://ols4zt49w.bkt.clouddn.com/1495100021%281%29.png" alt=""></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/15/QT网络编程之FTP/" itemprop="url">
                  QT网络编程之FTP
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-05-15T14:33:15+08:00" content="2017-05-15">
              2017-05-15
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/QT/" itemprop="url" rel="index">
                    <span itemprop="name">QT</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/05/15/QT网络编程之FTP/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/05/15/QT网络编程之FTP/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>FTP(文件传输协议)是一个主要用来<strong>浏览远程目录</strong>和<strong>传输文件</strong>的协议。FTP使用两个网络连接，一个用来发送命令，一个用来输出数据。FTP协议有一个状态，并且需要客户端在传输文件之前发送一些命令。FTP客户端建立一个连接，并且在整个会话期间<strong>一直保持打开</strong>。在每个会话期间可以发生多个传输。</p>
<p><strong>注意：</strong>在QT5之前，为了方便网络编程，Qt 提供了 Network 模块。<strong>该模块包含了许多类</strong>，例如：<strong>QFtp类</strong> - <strong>能够更加轻松使用 FTP 协议进行网络编程</strong>。但是，从 Qt5.x 之后，Qt Network 发生了很大的变化，不再导出 QFtp 和 QUrlInfo 类，改用了 QNetworkAccessManager。</p>
<p>在QT5中，使用 QNetworkAccessManager类实现FTP与前面的http应用十分相似，只需要在QUrl对象中设置好主机的地址，用户名，密码等，然后使用get()、put()等函数完成文件的获取和上传。<strong>注意：因为Qt5不再支持QFtp类,需要的话得重现编译.所以只能在根目录上传下载。如果想要实现其它功能，如：cd()改变服务器的工作目录到指定目录；list()列出ftp服务器上指定目录的内容，默认列出当前目录的内容；等，就只能用QFtp。</strong></p>
<p>虽然在QT5中QFtp类被废除了，在QT5中不能直接使用该类，但是在<strong>QT5的兼容性扩展模块QtFtp中包含了支持Qt5的QFtp类。</strong><br>QFtp 类提供了一个 FTP 协议的客户端实现，具有以下特点：<br>1.<strong>非阻塞行为，QFtp异步工作</strong>。如果无法立即执行操作，函数仍将立即返回，并且该操作将被调度以供以后执行。调度操作的结果通过信号报告，这种方法依赖于事件循环操作。</p>
<p>2.命令ID。可以调度的操作（也被称为“命令”）有：connectToHost()、login()、close()、list()、cd()、get()、put()、remove()、mkdir()、rmdir()、rename() 和 rawCommand()。<strong>当每一个命令被执行时，QFtp都会使用该命令ID发射commandStarted()和commandFinished()信号。</strong></p>
<p>3.数据传输进度指示。当<strong>有数据传输时</strong>，QFtp会发射信号( <strong>QFtp::dataTransferProgress()</strong>,QNetworkReply::downloadProgress()和QNetworkReply::uploadProgress() ),可以关联这些信号到QProgressBar::setProgress()或者QProgressDialog::setProgresss()上。</p>
<p>4.QIODevice支持。该类支持对QIODevice进行上传和下载。</p>
<p>这里我主要采用第二种方法，即采用QFtp类。我挑重点讲：<br><strong>连接</strong><br>在此处可以直接在ui界面里初始化，然后添加信号槽。ui界面如图：<br><img src="http://ols4zt49w.bkt.clouddn.com/34$LEQ9JRY3J5S~%5DCD08L14.png" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">// 连接按钮</div><div class="line">void MainWindow::on_connectButton_clicked()</div><div class="line">&#123;</div><div class="line">    ui-&gt;fileList-&gt;clear();</div><div class="line">    currentPath.clear();</div><div class="line">    isDirectory.clear();</div><div class="line">    ui-&gt;progressBar-&gt;setValue(0);</div><div class="line">    ui-&gt;progressBar_2-&gt;setValue(0);</div><div class="line">    ftp = new QFtp(this);</div><div class="line">    //每当一个命令被执行时，QFtp都会使用该命令ID发射commandStartedcommunity()和commandFinished()信号</div><div class="line">    connect(ftp, &amp;QFtp::commandStarted, this,</div><div class="line">            &amp;MainWindow::ftpCommandStarted);</div><div class="line">    connect(ftp, &amp;QFtp::commandFinished,</div><div class="line">            this, &amp;MainWindow::ftpCommandFinished);</div><div class="line"></div><div class="line">    //listInfo()信号在执行完list()命令时发射</div><div class="line">    connect(ftp, &amp;QFtp::listInfo, this, &amp;MainWindow::addToList);</div><div class="line"></div><div class="line">    //当有数据传输时，QFTP会发射信号（QFtp::dataTransferProgress(),QNetworkReply::downloadProgress()和QNetworkReply::uploadProgress()）</div><div class="line">   /* connect(ftp, &amp;QFtp::dataTransferProgress,</div><div class="line">            this, &amp;MainWindow::updateDataTransferProgress);</div><div class="line">    connect(ftp, &amp;QFtp::dataTransferProgress,</div><div class="line">            this, &amp;MainWindow::updateDataTransferProgress_2);*/</div><div class="line"></div><div class="line">    QString ftpServer = ui-&gt;ftpServerLineEdit-&gt;text();</div><div class="line">    QString userName = ui-&gt;userNameLineEdit-&gt;text();</div><div class="line">    QString passWord = ui-&gt;passWordLineEdit-&gt;text();</div><div class="line">    ftp-&gt;connectToHost(ftpServer, 21);</div><div class="line">    ftp-&gt;login(userName, passWord);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>当然，也可以请求连接服务器，代码如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">ftp = new QFtp(this);</div><div class="line"></div><div class="line">ftp-&gt;connectToHost(&quot;wscloudy.com&quot;);//指定端口连接到FTP服务器主机，默认端口号21</div><div class="line">ftp-&gt;login(&quot;user&quot;, &quot;8677&quot;);//指定用户名和密码登陆到FTP服务器</div><div class="line">ftp-&gt;get(&quot;sha.txt&quot;);//从服务器下载指定文件</div><div class="line">ftp-&gt;close();</div><div class="line">connect(ftp, &amp;QFtp::commandStarted,</div><div class="line">        this, &amp;MainWindow::ftpCommandStarted);</div><div class="line">connect(ftp, &amp;QFtp::commandFinished,</div><div class="line">        this, &amp;MainWindow::ftpCommandFinished);</div></pre></td></tr></table></figure></p>
<p><strong>下载</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">void MainWindow::on_downloadButton_clicked()</div><div class="line">&#123;</div><div class="line">    connect(ftp, &amp;QFtp::dataTransferProgress,</div><div class="line">            this, &amp;MainWindow::updateDataTransferProgress);</div><div class="line">    // 注意：因为文件名称可能是中文，所以在使用get()函数前需要进行编码转换</div><div class="line">    QString fileName = ui-&gt;fileList-&gt;currentItem()-&gt;text(0);</div><div class="line">    QString name = QLatin1String(fileName.toUtf8());</div><div class="line">    file = new QFile(fileName);//根据要下载的文件的名称创建本地文件</div><div class="line">    if (!file-&gt;open(QIODevice::WriteOnly)) &#123;</div><div class="line">        delete file;</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line">    ui-&gt;downloadButton-&gt;setEnabled(false);</div><div class="line">    ftp-&gt;get(name, file);//文件下载</div><div class="line">&#125;</div><div class="line">//下载进度更新</div><div class="line">void MainWindow::updateDataTransferProgress(qint64 readBytes,qint64 totalBytes)</div><div class="line">&#123;</div><div class="line">    ui-&gt;progressBar-&gt;setMaximum(totalBytes);</div><div class="line">    ui-&gt;progressBar-&gt;setValue(readBytes);</div><div class="line">   // ui-&gt;progressBar_2-&gt;setValue(0);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>上传</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">//上传按钮</div><div class="line">void MainWindow::on_uploadButton_clicked()</div><div class="line">&#123;</div><div class="line">    connect(ftp, &amp;QFtp::dataTransferProgress,</div><div class="line">            this, &amp;MainWindow::updateDataTransferProgress_2);</div><div class="line"></div><div class="line">    file = new QFile (&quot;E:/ftpshare/shalian.txt&quot;);</div><div class="line">    ftp-&gt;put(file,&quot;shalian.txt&quot;); //将我电脑E盘下的文件上传至服务器</div><div class="line">    ui-&gt;uploadButton-&gt;setEnabled(false);</div><div class="line"></div><div class="line">&#125;</div><div class="line">//上传进度更新</div><div class="line">void MainWindow::updateDataTransferProgress_2(qint64 readBytes,qint64 totalBytes)</div><div class="line">&#123;</div><div class="line">    ui-&gt;progressBar_2-&gt;setMaximum(totalBytes);</div><div class="line">    ui-&gt;progressBar_2-&gt;setValue(readBytes);</div><div class="line">    //ui-&gt;progressBar-&gt;setValue(0);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>注意</strong>：一开始我在学校用自己的电脑配置搭建了一个ftp服务器，但是由于是校园局域网，外网进来需要路由允许穿越。(当然我可没法要求校园网络管理员实现)，因此借助了公司同事服务器上的ftp服务器，在他的路由上设置了允许我的穿进。<br>本文参考了：<br><a href="http://blog.csdn.net/liang19890820/article/details/53318906" target="_blank" rel="external">http://blog.csdn.net/liang19890820/article/details/53318906</a><br><a href="http://blog.csdn.net/liang19890820/article/details/53188182" target="_blank" rel="external">http://blog.csdn.net/liang19890820/article/details/53188182</a><br><a href="http://blog.csdn.net/sinat_29173167/article/details/54601643" target="_blank" rel="external">http://blog.csdn.net/sinat_29173167/article/details/54601643</a><br>欢迎一起讨论交流！</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/15/c-动态申请二维数组并释放/" itemprop="url">
                  c++动态申请一维、二维数组并释放
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-05-15T08:59:59+08:00" content="2017-05-15">
              2017-05-15
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/c-c/" itemprop="url" rel="index">
                    <span itemprop="name">c/c++</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/05/15/c-动态申请二维数组并释放/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/05/15/c-动态申请二维数组并释放/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在平时写代码的过程中，常常会需要动态开辟一个二维数组，具体的行和列不再是常量，之前遇到了总是容易忘记，现在特地整理一下。同时将一维数组也整理了一下。<br>c++中有三种方法来动态申请多维数组</p>
<p><strong>(1)C中的malloc/free</strong></p>
<p><strong>(2)C++中的new/delete</strong></p>
<p><strong>(3)STL容器中的vector</strong></p>
<p><strong>第一种malloc/free</strong><br>动态开辟一维数组<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">动态开辟一维数组</div><div class="line">void dynamicCreate1Array()</div><div class="line">&#123;</div><div class="line">	int m;</div><div class="line">	int i;</div><div class="line">	int *p;</div><div class="line">    </div><div class="line">	printf(&quot;请输入开辟的数组长度：&quot;);</div><div class="line">	scanf(&quot;%d&quot;,&amp;m);</div><div class="line">	p = (int*)malloc(sizeof(int)*m);//动态开辟</div><div class="line"></div><div class="line">	printf(&quot;请输入数据：&quot;);</div><div class="line">	for(i = 0; i &lt; m ; i++)</div><div class="line">		scanf(&quot;%d&quot;,&amp;p[i]);</div><div class="line"></div><div class="line">    printf(&quot;输出数据：\n&quot;);</div><div class="line">	for(i = 0; i &lt; m; i++)</div><div class="line">		printf(&quot;%d &quot;,p[i]);</div><div class="line">	free(p);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>动态开辟二维数组<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">void dynamicCreate2Array()</div><div class="line">&#123;</div><div class="line">	int m,n;</div><div class="line">	int i,j;</div><div class="line">	int **p;</div><div class="line"></div><div class="line">    printf(&quot;请输入数组行和列：&quot;);</div><div class="line">	scanf(&quot;%d%d&quot;,&amp;m,&amp;n);</div><div class="line"></div><div class="line">	p = (int**)malloc(sizeof(int*)*m); //开辟行</div><div class="line"></div><div class="line">	for(i = 0; i &lt; m; i++)</div><div class="line">	&#123;</div><div class="line">		*(p+i) = (int*)malloc(sizeof(int)*n);//开辟列</div><div class="line">	&#125;</div><div class="line">	//输入数据</div><div class="line">	printf(&quot;请输入数：&quot;);</div><div class="line">    for(i = 0 ; i &lt; m;i++)</div><div class="line">		for(j = 0; j &lt; n;j++)</div><div class="line">			scanf(&quot;%d&quot;,&amp;p[i][j]);</div><div class="line">    </div><div class="line">	//输出数据</div><div class="line">	for(i = 0 ; i &lt; m;i++)</div><div class="line">	&#123;</div><div class="line">		for(j = 0; j &lt; n;j++)</div><div class="line">		&#123;</div><div class="line">		   printf(&quot;%3d &quot;,p[i][j]);</div><div class="line">		&#125;</div><div class="line">		printf(&quot;\n&quot;);</div><div class="line">	&#125;</div><div class="line">	//释放开辟的二维空间</div><div class="line">	for(i = 0; i &lt; m;i++)</div><div class="line">		free(*(p+i));</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>第二种：new/delete</strong><br>1.动态开辟一维数组<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">void DynamicCreate1Array()</div><div class="line">&#123;</div><div class="line">	int len;</div><div class="line">	</div><div class="line">	cout&lt;&lt;&quot;请输入长度：&quot;;</div><div class="line">	cin&gt;&gt;len;</div><div class="line">	</div><div class="line">	int *p = new int[len];</div><div class="line">	</div><div class="line">	cout&lt;&lt;&quot;请输入数据：&quot;;</div><div class="line">    for(int i = 0; i &lt; len; i++)</div><div class="line">		cin&gt;&gt;p[i];</div><div class="line">	</div><div class="line">	cout&lt;&lt;&quot;输出数据：&quot;&lt;&lt;endl;</div><div class="line">	for(i = 0; i &lt; len; i++)</div><div class="line">		cout&lt;&lt;setw(4)&lt;&lt;p[i];</div><div class="line">	</div><div class="line">	delete[] p;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>2.动态开辟二维数组<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">void DynamicCreate2Array()</div><div class="line">&#123;</div><div class="line">	int m, n;</div><div class="line">	cout &lt;&lt; &quot;请输入行和列：&quot;;</div><div class="line">	cin &gt;&gt; m &gt;&gt; n;</div><div class="line"></div><div class="line">	//动态开辟空间</div><div class="line">	int **p = new int*[m]; //开辟行</div><div class="line">	for (int i = 0; i &lt; m; i++)</div><div class="line">		p[i] = new int[n]; //开辟列</div><div class="line"></div><div class="line">	cout &lt;&lt; &quot;请输入数据：&quot;;</div><div class="line">	for (int i = 0; i &lt; m; i++)</div><div class="line">	for (int j = 0; j &lt; n; j++)</div><div class="line">		cin &gt;&gt; p[i][j];</div><div class="line"></div><div class="line">	cout &lt;&lt; &quot;输出数据：&quot; &lt;&lt; endl;</div><div class="line">	for (int i = 0; i &lt; m; i++)</div><div class="line">	&#123;</div><div class="line">		for (int j = 0; j &lt; n; j++)</div><div class="line">			cout &lt;&lt; setw(3) &lt;&lt; p[i][j];</div><div class="line">		cout &lt;&lt; endl;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	//释放开辟的资源</div><div class="line">	for (int i = 0; i &lt; m; i++)</div><div class="line">		delete[] p[i];</div><div class="line">	delete[] p;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>第三种：STL中的vector</strong><br>动态开辟二维数组<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">void VectorCreate()</div><div class="line">&#123;</div><div class="line">	int m,n;</div><div class="line">	cout&lt;&lt;&quot;请输入行和列：&quot;;</div><div class="line">	cin&gt;&gt;m&gt;&gt;n;</div><div class="line">	</div><div class="line">	//注意下面这一行：vector &lt;int后两个 &quot;&gt; &quot;之间要有空格！否则会被认为是重载 &quot;&gt; &gt; &quot;。 </div><div class="line">    vector&lt;vector&lt;int&gt; &gt; p(m,vector&lt;int&gt;(n));</div><div class="line">	</div><div class="line">	cout&lt;&lt;&quot;请输入数据：&quot;;</div><div class="line">	for(int i = 0 ; i &lt; m ; i++)</div><div class="line">		for(int j = 0; j &lt; n; j++)</div><div class="line">			cin&gt;&gt;p[i][j];</div><div class="line">		</div><div class="line">	cout&lt;&lt;&quot;输出数据：&quot;&lt;&lt;endl;</div><div class="line">	for(int i = 0; i &lt; m; i++)</div><div class="line">	&#123;</div><div class="line">    	for(int j = 0; j &lt; n; j++)</div><div class="line">			cout&lt;&lt;setw(3)&lt;&lt;p[i][j];</div><div class="line">		cout&lt;&lt;endl;</div><div class="line">	&#125;</div><div class="line">			</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/05/QT实现简单的天气预报/" itemprop="url">
                  QT实现简单的天气预报
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-05-05T16:16:26+08:00" content="2017-05-05">
              2017-05-05
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/QT/" itemprop="url" rel="index">
                    <span itemprop="name">QT</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/05/05/QT实现简单的天气预报/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/05/05/QT实现简单的天气预报/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Qt 进行网络访问的类是QNetworkAccessManager,QNetworkAccessManager类允许应用程序发送网络请求以及接受服务器的响应。事实上，Qt 的整个访问网络 API 都是围绕着这个类进行的。QNetworkAccessManager保存发送的请求的最基本的配置信息，包含了代理和缓存的设置。最好的是，这个 API 本身就是异步设计，这意味着我们不需要自己为其开启线程，以防止界面被锁死。<strong>（补充：Qt 的界面活动是在一个主线程中进行。网络访问是一个相当耗时的操作，如果整个网络访问的过程以同步的形式在主线程进行，则当网络访问没有返回时，主线程会被阻塞，界面就会被锁死，不能执行任何响应，甚至包括一个代表响应进度的滚动条都会被卡死在那里。）</strong>QNetworkAccessManager是使用信号槽来达到这一目的的。<br>在掌握了访问网络和json解析等，我在此简易做了一个天气预报，既添加了学习趣味，也算是一种检验吧。</p>
<h4 id="一、API"><a href="#一、API" class="headerlink" title="一、API"></a>一、API</h4><p>通过天气api获取当前天气，api网上有很多，我在此注册了一个 <a href="http://www.haoservice.com/" target="_blank" rel="external">http://www.haoservice.com/</a> 账号，可以免费申请数据，由于是体验用户，可以享受免费请求50次（调试的时候注意，如果调试访问超过50次就得花钱了）。<br>需要自己申请apikey,同时获取到的天气api数据是Jason格式的。<br><img src="http://ols4zt49w.bkt.clouddn.com/WX%7D@H%250$OFOPFI%5D$0%25AE901.png" alt=""></p>
<p><img src="http://ols4zt49w.bkt.clouddn.com/~@%28GSJZI@NMK%7BV~Y$YBOJUA.png" alt=""></p>
<p><strong>API发送请求</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">//发送请求</div><div class="line">void Widget::on_pushButton_clicked()</div><div class="line">&#123;</div><div class="line">    manage = new QNetworkAccessManager(this);</div><div class="line">    QNetworkRequest network_request;</div><div class="line"></div><div class="line"></div><div class="line">    /*设置发送数据*/</div><div class="line"></div><div class="line">   //QString cityName = &quot;杭州&quot;;</div><div class="line"></div><div class="line">   network_request.setUrl(QUrl(&quot;http://apis.haoservice.com/weather?cityname=%E6%9D%AD%E5%B7%9E&amp;key=4c08a10447eb435e98080000c50f3f77&amp;paybyvas=false&quot;));</div><div class="line"></div><div class="line"></div><div class="line">   /* 注意：当url里有中文或空格之类的，需要用一些在线转码工具进行url编码，这里纠结了很久*/</div><div class="line">   // network_request.setUrl(QUrl(QString(&quot; http://apis.haoservice.com/weather?cityname=1%&amp;key=4c08a10447eb435e98080000c50f3f77&amp;paybyvas=false&quot;).arg(cityName)));</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">    /*发送get网络请求*/</div><div class="line">    manage-&gt;get(network_request);</div><div class="line"></div><div class="line">    /*建立connect，replyFinished为自定义槽函数，获取api发回来的天气信息（Jason）格式*/</div><div class="line">    connect(manage,SIGNAL(finished(QNetworkReply *)),this,SLOT( getReplyFinished(QNetworkReply *)) );</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在这里我一开始遇到了一个问题，很容易忽视，因为我的url中有中文的存在，每次访问都会失败，但是将网址输入浏览器却能有响应，这是因为浏览器会自动解析编码url，但是当你在代码中想访问请求时必须得编码，在此可以用在线编码软件，如下图：<br><img src="http://ols4zt49w.bkt.clouddn.com/url%E7%BC%96%E7%A0%81.png" alt=""></p>
<p><strong>获取API传回得数据</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">void Widget::getReplyFinished(QNetworkReply *reply)</div><div class="line">&#123;</div><div class="line">    if(reply-&gt;error()!= QNetworkReply::NoError)</div><div class="line">       qDebug() &lt;&lt; QStringLiteral(&quot;响应失败&quot;);</div><div class="line"></div><div class="line">    QByteArray bytes = reply-&gt;readAll();</div><div class="line">    QJsonParseError jsonError;</div><div class="line">    QJsonDocument document = QJsonDocument::fromJson(bytes,&amp;jsonError);</div><div class="line">    if (jsonError.error != QJsonParseError::NoError) &#123;</div><div class="line">            qDebug() &lt;&lt; QStringLiteral(&quot;解析Json失败&quot;);//此处可以验证是否获取到天气信息（json格式）</div><div class="line">            qDebug() &lt;&lt; bytes;//如果API响应的不是json格式的数据，则不用解析，直接输出</div><div class="line">            return;</div><div class="line">        &#125;</div><div class="line">    QJsonObject data = document.object();</div><div class="line">    qDebug() &lt;&lt; &quot;天气Jason：&quot; &lt;&lt; data;</div><div class="line"></div><div class="line">    getTodayWeatherInfo(data);//获取当日天气信息</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">//获取当日天气信息，即解析json</div><div class="line">void Widget::getTodayWeatherInfo(QJsonObject data)</div><div class="line">&#123;</div><div class="line">    QJsonObject today = data.value(&quot;result&quot;).toObject().value(&quot;today&quot;).toObject();</div><div class="line">    WeatherInfo todayInfo;</div><div class="line">    todayInfo.city = today.value(&quot;city&quot;).toString();//北京</div><div class="line">    todayInfo.date = today.value(&quot;date_y&quot;).toString();//2017年05月04日</div><div class="line">    todayInfo.week = today.value(&quot;week&quot;).toString();//星期</div><div class="line">    todayInfo.type = today.value(&quot;weather&quot;).toString();//阵雨</div><div class="line">    todayInfo.curTemp = today.value(&quot;temperature&quot;).toString();//温度</div><div class="line">    todayInfo.fengli = today.value(&quot;wind&quot;).toString();//风</div><div class="line"></div><div class="line"></div><div class="line">    qDebug() &lt;&lt; &quot;getTodayWeatherInfo:\n&quot; &lt;&lt;todayInfo.city&lt;&lt; todayInfo.date &lt;&lt; todayInfo.week &lt;&lt; todayInfo.type &lt;&lt; todayInfo.curTemp</div><div class="line">            &lt;&lt;todayInfo.fengli ;</div><div class="line"></div><div class="line">    QStringList todayInfoList;//在文本框里显示</div><div class="line">    todayInfoList &lt;&lt;todayInfo.city &lt;&lt; todayInfo.date + todayInfo.week &lt;&lt; todayInfo.type &lt;&lt; todayInfo.curTemp</div><div class="line">                   &lt;&lt; todayInfo.fengli ;</div><div class="line">    for(int i=0; i &lt; todayInfoList.size(); i++)</div><div class="line">    &#123;</div><div class="line">        ui-&gt;textBrowser-&gt;append(todayInfoList.at(i));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>结果如下：<br><img src="http://ols4zt49w.bkt.clouddn.com/8%7DPG7BQ76JQ%29R20%5DE%608%7D0B2.png" alt=""><br>返回的json数据如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    &quot;error_code&quot;: 0,</div><div class="line">    &quot;reason&quot;: &quot;成功&quot;,</div><div class="line">    &quot;result&quot;: &#123;</div><div class="line">        &quot;sk&quot;: &#123;</div><div class="line">            &quot;temp&quot;: &quot;25&quot;,</div><div class="line">            &quot;wind_direction&quot;: &quot;北风&quot;,</div><div class="line">            &quot;wind_strength&quot;: &quot;4级&quot;,</div><div class="line">            &quot;humidity&quot;: &quot;57&quot;,</div><div class="line">            &quot;time&quot;: &quot;16:34&quot;</div><div class="line">        &#125;,</div><div class="line">        &quot;today&quot;: &#123;</div><div class="line">            &quot;city&quot;: &quot;杭州&quot;,</div><div class="line">            &quot;date_y&quot;: &quot;2017年05月05日&quot;,</div><div class="line">            &quot;week&quot;: &quot;星期五&quot;,</div><div class="line">            &quot;temperature&quot;: &quot;17~27&quot;,</div><div class="line">            &quot;weather&quot;: &quot;多云&quot;,</div><div class="line">            &quot;fa&quot;: &quot;01&quot;,</div><div class="line">            &quot;fb&quot;: &quot;01&quot;,</div><div class="line">            &quot;wind&quot;: &quot;西北风 3-4 级&quot;,</div><div class="line">            &quot;dressing_index&quot;: &quot;舒适&quot;,</div><div class="line">            &quot;dressing_advice&quot;: &quot;建议着长袖T恤、衬衫加单裤等服装。年老体弱者宜着针织长袖衬衫、马甲和长裤。&quot;,</div><div class="line">            &quot;uv_index&quot;: &quot;弱&quot;,</div><div class="line">            &quot;comfort_index&quot;: &quot;--&quot;,</div><div class="line">            &quot;wash_index&quot;: &quot;较适宜&quot;,</div><div class="line">            &quot;travel_index&quot;: &quot;较适宜&quot;,</div><div class="line">            &quot;exercise_index&quot;: &quot;较适宜&quot;,</div><div class="line">            &quot;drying_index&quot;: &quot;--&quot;</div><div class="line">        &#125;,</div><div class="line">        &quot;future&quot;: [&#123;</div><div class="line">            &quot;temperature&quot;: &quot;15~23&quot;,</div><div class="line">            &quot;weather&quot;: &quot;阴&quot;,</div><div class="line">            &quot;fa&quot;: &quot;02&quot;,</div><div class="line">            &quot;fb&quot;: &quot;01&quot;,</div><div class="line">            &quot;wind&quot;: &quot;东北风 微风&quot;,</div><div class="line">            &quot;week&quot;: &quot;星期六&quot;,</div><div class="line">            &quot;date&quot;: &quot;20170506&quot;</div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">            &quot;temperature&quot;: &quot;16~25&quot;,</div><div class="line">            &quot;weather&quot;: &quot;阴&quot;,</div><div class="line">            &quot;fa&quot;: &quot;02&quot;,</div><div class="line">            &quot;fb&quot;: &quot;03&quot;,</div><div class="line">            &quot;wind&quot;: &quot;东风 微风&quot;,</div><div class="line">            &quot;week&quot;: &quot;星期日&quot;,</div><div class="line">            &quot;date&quot;: &quot;20170507&quot;</div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">            &quot;temperature&quot;: &quot;17~22&quot;,</div><div class="line">            &quot;weather&quot;: &quot;阵雨&quot;,</div><div class="line">            &quot;fa&quot;: &quot;03&quot;,</div><div class="line">            &quot;fb&quot;: &quot;02&quot;,</div><div class="line">            &quot;wind&quot;: &quot;东南风 微风&quot;,</div><div class="line">            &quot;week&quot;: &quot;星期一&quot;,</div><div class="line">            &quot;date&quot;: &quot;20170508&quot;</div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">            &quot;temperature&quot;: &quot;17~24&quot;,</div><div class="line">            &quot;weather&quot;: &quot;多云&quot;,</div><div class="line">            &quot;fa&quot;: &quot;01&quot;,</div><div class="line">            &quot;fb&quot;: &quot;01&quot;,</div><div class="line">            &quot;wind&quot;: &quot;南风 微风&quot;,</div><div class="line">            &quot;week&quot;: &quot;星期二&quot;,</div><div class="line">            &quot;date&quot;: &quot;20170509&quot;</div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">            &quot;temperature&quot;: &quot;19~32&quot;,</div><div class="line">            &quot;weather&quot;: &quot;晴&quot;,</div><div class="line">            &quot;fa&quot;: &quot;00&quot;,</div><div class="line">            &quot;fb&quot;: &quot;00&quot;,</div><div class="line">            &quot;wind&quot;: &quot;西南风 微风&quot;,</div><div class="line">            &quot;week&quot;: &quot;星期三&quot;,</div><div class="line">            &quot;date&quot;: &quot;20170510&quot;</div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">            &quot;temperature&quot;: &quot;21~31&quot;,</div><div class="line">            &quot;weather&quot;: &quot;多云&quot;,</div><div class="line">            &quot;fa&quot;: &quot;01&quot;,</div><div class="line">            &quot;fb&quot;: &quot;04&quot;,</div><div class="line">            &quot;wind&quot;: &quot;西北风 微风&quot;,</div><div class="line">            &quot;week&quot;: &quot;星期四&quot;,</div><div class="line">            &quot;date&quot;: &quot;20170511&quot;</div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">            &quot;temperature&quot;: &quot;20~28&quot;,</div><div class="line">            &quot;weather&quot;: &quot;雷阵雨&quot;,</div><div class="line">            &quot;fa&quot;: &quot;04&quot;,</div><div class="line">            &quot;fb&quot;: &quot;01&quot;,</div><div class="line">            &quot;wind&quot;: &quot;西北风 微风&quot;,</div><div class="line">            &quot;week&quot;: &quot;星期五&quot;,</div><div class="line">            &quot;date&quot;: &quot;20170512&quot;</div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">            &quot;temperature&quot;: &quot;20~29&quot;,</div><div class="line">            &quot;weather&quot;: &quot;多云&quot;,</div><div class="line">            &quot;fa&quot;: &quot;01&quot;,</div><div class="line">            &quot;fb&quot;: &quot;00&quot;,</div><div class="line">            &quot;wind&quot;: &quot;西南风 微风&quot;,</div><div class="line">            &quot;week&quot;: &quot;星期六&quot;,</div><div class="line">            &quot;date&quot;: &quot;20170513&quot;</div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">            &quot;temperature&quot;: &quot;19~29&quot;,</div><div class="line">            &quot;weather&quot;: &quot;多云&quot;,</div><div class="line">            &quot;fa&quot;: &quot;01&quot;,</div><div class="line">            &quot;fb&quot;: &quot;01&quot;,</div><div class="line">            &quot;wind&quot;: &quot;西南风 微风&quot;,</div><div class="line">            &quot;week&quot;: &quot;星期日&quot;,</div><div class="line">            &quot;date&quot;: &quot;20170514&quot;</div><div class="line">        &#125;]</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这里我只解析了显示了today的一部分，并用文本框textbrowser里显示</p>
<h4 id="二、换肤"><a href="#二、换肤" class="headerlink" title="二、换肤"></a>二、换肤</h4><p>这里我主要设置了背景图片，并且想要达到点击换肤的效果。<br>widget设置显示背景图片我这里尝试了三种方法：<br>方法一：如果widget是顶层窗口（无父类的窗口),设置背景图片<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">/* 如果widget是顶层窗口（无父类的窗口),设置背景图片*/</div><div class="line">           //方法一：</div><div class="line">     /* QImage _image;</div><div class="line">      _image.load(&quot;:/image/images/UI1.png&quot;);</div><div class="line">      setAutoFillBackground(true);   // 这个属性一定要设置</div><div class="line">      QPalette pal(palette());</div><div class="line">      pal.setBrush(QPalette::Window, QBrush(_image.scaled(size(), Qt::IgnoreAspectRatio,</div><div class="line">                          Qt::SmoothTransformation)));</div><div class="line">      setPalette(pal);</div><div class="line">     */</div></pre></td></tr></table></figure></p>
<p>方法二：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">     // 方法二：</div><div class="line">/*QPalette palette;</div><div class="line">//palette.setColor(QPalette::Background, QColor(192,253,123));//设置背景颜色</div><div class="line">  palette.setBrush(QPalette::Background, QBrush(QPixmap(&quot;:/image/images/UI1.png&quot;)));</div><div class="line"></div><div class="line">      //上面一句相当于下面两句</div><div class="line">//pixmap.load(&quot;:/image/images/UI1.png&quot;);</div><div class="line">//palette.setBrush(QPalette::Background, QBrush(pixmap));</div><div class="line"></div><div class="line">  setPalette(palette);</div><div class="line">*/</div></pre></td></tr></table></figure></p>
<p>方法三：利用QPainter的drawPixmap函数，这种方法只能用在paintEvent()函数中<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">   //方法三：利用QPainter的drawPixmap函数，这种方法只能用在paintEvent()函数中</div><div class="line">void Widget::paintEvent(QPaintEvent *)</div><div class="line">&#123;</div><div class="line">    QPainter painter(this);</div><div class="line">   // QPixmap pixmap(&quot;:/image/images/UI.png&quot;);</div><div class="line">    painter.drawPixmap(0, 0, pixmap);//绘制UI</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这里为了达到换肤的效果，我采用了第三种方法。同时初始背景图片</p>
<blockquote>
<p>pixmap.load(“:/image/images/UI0”); //初始背景图片<br>// resize(pixmap.size());//保留图片大小<br>uid=0;</p>
</blockquote>
<p>下面是简单的换肤程序：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">//简单换肤</div><div class="line">void Widget::on_updateButton_clicked()</div><div class="line">&#123;</div><div class="line">    //选择UI的id</div><div class="line">    if(uid == 3)</div><div class="line">        uid = 0;</div><div class="line">    else</div><div class="line">        uid = uid + 1;</div><div class="line">    //拼凑成UI路径</div><div class="line">    QString UIpath = tr(&quot;:/image/images/UI%1&quot;).arg(uid);</div><div class="line">    //qDebug()&lt;&lt;UIpath;</div><div class="line">    //加载UI</div><div class="line">    pixmap.load(UIpath);</div><div class="line">    //产生paintEvent重绘UI</div><div class="line">    update();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>效果如下：<br><img src="http://ols4zt49w.bkt.clouddn.com/%E5%A4%A9%E6%B0%94%E9%A2%84%E6%8A%A5.png" alt=""><br> 此处是由于在初始化时没有注释掉  <code>// resize(pixmap.size());//保留图片大小</code><br> 在注释掉后，界面明显有了改善：<br> <img src="http://ols4zt49w.bkt.clouddn.com/8$B$VNGGW%28%7DW~%29%259E@W%25X%7BR.png" alt=""><br> <img src="http://ols4zt49w.bkt.clouddn.com/G2@B9OIGUOBUCB%60_A%5BG0WWP.png" alt=""></p>
<h4 id="三、展望"><a href="#三、展望" class="headerlink" title="三、展望"></a>三、展望</h4><p>到此，我想实现的效果已经基本实现，所学的知识也有了检验，但是偶然在网上看到一个帖子，里面有一个更加完善的demo,在此我把它贴出，代码量不是太多，功能和我的差不多，但是他的布局和界面优化显示明显花了更大的功夫。详细代码参考这里：<a href="https://github.com/ghsxl/QT5-Weather" target="_blank" rel="external">github</a><br>最终的效果：<br><img src="http://ols4zt49w.bkt.clouddn.com/@%6037TE2%7B05ZAYR5%29VAQ%7B45O.png" alt=""></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/23/QT之http网络编程，json访问应答/" itemprop="url">
                  QT之http网络编程，json访问应答
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-04-23T11:02:46+08:00" content="2017-04-23">
              2017-04-23
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/QT/" itemprop="url" rel="index">
                    <span itemprop="name">QT</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/04/23/QT之http网络编程，json访问应答/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/04/23/QT之http网络编程，json访问应答/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>结合前面两篇文章《浅谈http之post与get的区别》和《QT之json》，本文重点尝试了如何在qt中通过http协议json格式请求和响应服务器的json格式，并解析。<br>本文的重点是客户端的编写，服务器用的是一个简易的http本地服务器。<br>服务器端的响应程序如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">void HttpServer::onRequest(HttpRequest* req, HttpResponse* resp)</div><div class="line">&#123;</div><div class="line">	//实现你的响应代码</div><div class="line">	QString reply  = tr(&quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;Rokh Server Test&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;hello!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;&quot;);</div><div class="line">    resp-&gt;setHeader(&quot;Content-Type&quot;, &quot;text/html&quot;);</div><div class="line">    resp-&gt;setHeader(&quot;Content-Type&quot;,&quot;application/json&quot;);</div><div class="line">	resp-&gt;setStatus(200);</div><div class="line"></div><div class="line">    resp-&gt;end(QString(&quot;&#123;&quot;</div><div class="line">                      &quot;\&quot;name\&quot;:\&quot;QT\&quot;,&quot;</div><div class="line">                      &quot;\&quot;version\&quot;:5,&quot;</div><div class="line">                      &quot;\&quot;windows\&quot;:true&quot;</div><div class="line">                      &quot;&#125;&quot;)</div><div class="line"></div><div class="line">);</div><div class="line">    //resp-&gt;end(QString(&quot;Test ok!&quot;));</div><div class="line">	return;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>客户端的程序：在mainwindow.cpp中<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div></pre></td><td class="code"><pre><div class="line"> &#123;</div><div class="line">    QNetworkRequest req;//构造一个请求</div><div class="line">    req.setUrl(QUrl(&quot;http://localhost:58890/post&quot;));</div><div class="line">    req.setHeader(QNetworkRequest::ContentTypeHeader, QVariant(&quot;application/json&quot;));</div><div class="line">    QNetworkAccessManager *manager = new QNetworkAccessManager(this);</div><div class="line">    /***json数据**********/</div><div class="line">    QJsonObject json;</div><div class="line">    json.insert(&quot;name&quot;, &quot;Qt&quot;);</div><div class="line">    json.insert(&quot;version&quot;, 7);</div><div class="line">    json.insert(&quot;windows&quot;, true);</div><div class="line"></div><div class="line">    QJsonDocument document;</div><div class="line">    document.setObject(json);</div><div class="line">    QByteArray byte_array = document.toJson(QJsonDocument::Compact);</div><div class="line"></div><div class="line">    //QNetworkReply *reply = manager.post(req, QByteArray(&quot;&#123;&#125;&quot;));</div><div class="line">    //QNetworkReply *reply = manager-&gt;post(req,byte_array);//发送请求，并会获得一个reply的响应对象</div><div class="line">    manager-&gt;post(req,byte_array);//发送请求，使用 json 参数直接传递</div><div class="line"></div><div class="line"></div><div class="line">    //开启一个局部的事件循环，等待响应结束，</div><div class="line">    //退出因为请求的过程是异步的，所以此时使用 QEventLoop 开启一个局部的事件循环，等待响应结束，事件循环退出。</div><div class="line">    //注意：开启事件循环的同时，程序界面将不会响应用户操作（界面被阻塞）。</div><div class="line">   // QEventLoop ev;</div><div class="line">   //连接槽信号</div><div class="line">   // QObject::connect(manager, &amp;QNetworkAccessManager::finished, &amp;ev, &amp;QEventLoop::quit);</div><div class="line">    connect(manager, SIGNAL(finished(QNetworkReply *)), this, SLOT(replyFinished(QNetworkReply *)));</div><div class="line"></div><div class="line">   // ev.exec();</div><div class="line">   //connect(reply, SIGNAL(finished()), &amp;ev, SLOT(quit()));</div><div class="line">   // ev.exec(QEventLoop::ExcludeUserInputEvents);</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">MainWindow::~MainWindow()</div><div class="line">&#123;</div><div class="line">    delete ui;</div><div class="line">&#125;</div><div class="line">//槽函数，获取响应的内容，调用 readAll()，由于上述的 POST 请求返回的数据为 Json 格式，将响应结果先转化为 Json，然后再对其解析</div><div class="line">void MainWindow::replyFinished(QNetworkReply *reply)</div><div class="line">&#123;</div><div class="line">    if(reply-&gt;error()!= QNetworkReply::NoError)</div><div class="line">         qDebug() &lt;&lt; QStringLiteral(&quot;响应失败&quot;);</div><div class="line"></div><div class="line">    // 获取响应信息，响应的内容可以是 HTML 页面，也可以是字符串、Json、XML等</div><div class="line">    QByteArray bytes = reply-&gt;readAll();</div><div class="line"></div><div class="line">    QJsonParseError jsonError;</div><div class="line">    QJsonDocument doucment = QJsonDocument::fromJson(bytes, &amp;jsonError);// 转化为 JSON文档</div><div class="line">    if (jsonError.error != QJsonParseError::NoError) &#123;</div><div class="line">        qDebug() &lt;&lt; QStringLiteral(&quot;解析Json失败&quot;);</div><div class="line">        qDebug() &lt;&lt; bytes;//如果服务器里响应的不是json格式的数据，则不用解析，直接输出</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    // 解析Json</div><div class="line">    if (doucment.isObject()) &#123;              // JSON 文档为对象</div><div class="line">        QJsonObject obj = doucment.object();// 转化为对象</div><div class="line">        QJsonValue value;</div><div class="line">        if (obj.contains(&quot;name&quot;)) &#123;</div><div class="line">            value = obj.take(&quot;name&quot;);      //Removes key from the object.</div><div class="line">            if (value.isString()) &#123;         //判断 value 是否为字符串</div><div class="line"></div><div class="line">                QString data = value.toString();// 将 value 转化为字符串</div><div class="line"></div><div class="line">                qDebug() &lt;&lt; endl &lt;&lt; data;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        if (obj.contains(&quot;version&quot;)) &#123;</div><div class="line">            value = obj.take(&quot;version&quot;);//Removes key from the object.</div><div class="line">            if(value.isDouble())</div><div class="line">            &#123;</div><div class="line">                int data = value.toVariant().toInt();</div><div class="line">                qDebug() &lt;&lt; data;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        if (obj.contains(&quot;windows&quot;)) &#123;</div><div class="line">            value = obj.take(&quot;windows&quot;);//Removes key from the object.</div><div class="line">            if(value.isBool())</div><div class="line">            &#123;</div><div class="line">                bool flag = value.toBool();</div><div class="line">                qDebug() &lt;&lt; flag ;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    else</div><div class="line">    &#123;</div><div class="line">        qDebug() &lt;&lt; &quot;error, shoud json object&quot;;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    //检测响应状态码,200 OK，表示请求已成功，请求所希望的响应头或数据体将随此响应返回</div><div class="line">    QVariant variant = reply-&gt;attribute(QNetworkRequest::HttpStatusCodeAttribute);</div><div class="line">    if (variant.isValid())</div><div class="line">        qDebug() &lt;&lt; variant.toInt();</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>程序中请求是以json对象格式请求的，所以需要先使用 tojson()将QJsonDocument类文件转换成文本文件</p>
<blockquote>
<p>QByteArray byte_array = document.toJson(QJsonDocument::Compact);//转换成了字节数组</p>
</blockquote>
<p>然后发送请求<code>manager-&gt;post(req,byte_array);</code>//发送请求</p>
<p>槽函数，获取响应的内容，调用 readAll()，由于上述的 POST 请求返回的数据为 Json 格式，将响应结果先转化为Json（fromjson函数），然后再对其解析。</p>
<p>结果解析如下：<br><img src="http://ols4zt49w.bkt.clouddn.com/1492952805%281%29.png" alt=""><br>服务器端响应的json格式数据被解析并输出。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/23/浅谈http之post与get的区别/" itemprop="url">
                  浅谈http之post与get的区别
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-04-23T11:00:13+08:00" content="2017-04-23">
              2017-04-23
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/网络编程/" itemprop="url" rel="index">
                    <span itemprop="name">网络编程</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/04/23/浅谈http之post与get的区别/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/04/23/浅谈http之post与get的区别/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="一、原理区别"><a href="#一、原理区别" class="headerlink" title="一、原理区别"></a>一、原理区别</h3><p>一般在浏览器中输入网址访问资源都是通过GET方式；在FORM提交中，可以通过Method指定提交方式为GET或者POST，默认为GET提交。<br>Http定义了与服务器交互的不同方法，最基本的方法有4种，分别是GET，POST，PUT，DELETE<br>URL全称是资源描述符，我们可以这样认 为：一个URL地址，它用于描述一个网络上的资源，而HTTP中的GET，POST，PUT，DELETE就对应着对这个资源的查 ，改 ，增 ，删 4个操作。<br>到这里，大家应该有个大概的了解了，<strong>GET一般用于获取/查询 资源信息，而POST一般用于更新 资源信息(个人认为这是GET和POST的本质区别，也是协议设计者的本意，其它区别都是具体表现形式的差异 )。</strong></p>
<p><strong><em>根据 HTTP 规范，GET用于信息获取，而且应该是安全的和幂等的 。</em></strong><br>　　1.所谓安全的意味着该操作用于获取信息而非修改信息。换句话说，GET请求一般不应产生副作用。就是说，它仅仅是获取资源信息，就像数据库查询一样，不会修改，增加数据，不会影响资源的状态。<br>　　<strong><em>注意</em></strong>：这里安全的含义仅仅是指是非修改信息。<br>　　2.幂等的意味着对同一URL的多个请求应该返回同样的结果。这里我再解释一下幂等 这个概念：<br>　　幂等 （idempotent、idempotence）是一个数学或计算机学概念，常见于抽象代数中。<br>　　幂等有以下几种定义：<br>　　对于单目运算，如果一个运算对于在范围内的所有的一个数多次进行该运算所得的结果和进行一次该运算所得的结果是一样的，那么我们就称该运算是幂等的。比如绝对值运算就是一个例子，在实数集中，有abs(a) = abs(abs(a)) 。<br>　　对于双目运算，则要求当参与运算的两个值是等值的情况下，如果满足运算结果与参与运算的两个值相等，则称该运算幂等，如求两个数的最大值的函数，有在在实数集中幂等，即max(x,x)  =  x 。<br>看完上述解释后，应该可以理解GET幂等的含义了。<br>　　但在实际应用中，以上2条规定并没有这么严格。引用别人文章的例子：比如，新闻站点的头版不断更新。虽然第二次请求会返回不同的一批新闻，该操 作仍然被认为是安全的和幂等的，因为它总是返回当前的新闻。从根本上说，如果目标是当用户打开一个链接时，他可以确信从自身的角度来看没有改变资源即可。<br><strong><em>根据HTTP规范，POST表示可能修改变服务器上的资源的请求 。</em></strong>继续引用上面的例子：还是新闻以网站为例，读者对新闻发表自己的评论应该通过POST实现，因为在评论提交后站点的资源已经不同了，或者说资源被修改了。</p>
<h3 id="二、表现形式差别"><a href="#二、表现形式差别" class="headerlink" title="二、表现形式差别"></a>二、表现形式差别</h3><p>搞清了两者的原理区别，我们再来看一下他们实际应用中的区别：<br>为了理解两者在传输过程中的不同，我们先看一下HTTP协议的格式：</p>
<h4 id="HTTP请求："><a href="#HTTP请求：" class="headerlink" title="HTTP请求："></a><strong>HTTP请求：</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;request line&gt;</div><div class="line">&lt;headers&gt;</div><div class="line">&lt;blank line&gt;</div><div class="line">&lt;request-body&gt;</div></pre></td></tr></table></figure>
<p>在HTTP请求中，第一行必须是一个请求行（request line），用来说明请求类型、要访问的资源以及使用的HTTP版本。紧接着是一个首部（header）小节，用来说明服务器要使用的附加信息。在首部之后是一个空行，再此之后可以添加任意的其他数据 [称之为主体（body）]。</p>
<p><strong>GET与POST方法实例：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">GET /books/?sex=man&amp;name=Professional HTTP/1.1</div><div class="line">Host: www.wrox.com</div><div class="line">User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.7.6)</div><div class="line">Gecko/20050225 Firefox/1.0.1</div><div class="line">Connection: Keep-Alive</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">POST / HTTP/1.1</div><div class="line">Host: www.wrox.com</div><div class="line">User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.7.6)</div><div class="line">Gecko/20050225 Firefox/1.0.1</div><div class="line">Content-Type: application/x-www-form-urlencoded</div><div class="line">Content-Length: 40</div><div class="line">Connection: Keep-Alive</div><div class="line"> （----此处空一行----）</div><div class="line">name=Professional%20Ajax&amp;publisher=Wiley</div></pre></td></tr></table></figure>
<p>有了以上对HTTP请求的了解和示例，我们再来看<strong>两种提交方式的区别</strong>：<br>(1)<strong>GET提交</strong>，请求的数据会附在URL之后（就是把数据放置在HTTP协议头中），以?分割URL和传输数据，多个参数用&amp;连接；例如：login.action?name=hyddd&amp;password=idontknow&amp;verify=%E4%BD%A0 %E5%A5%BD。如果数据是英文字母/数字，原样发送，如果是空格，转换为+，如果是中文/其他字符，则直接把字符串用BASE64加密，得出如： %E4%BD%A0%E5%A5%BD，其中％XX中的XX为该符号以16进制表示的ASCII。<br>　<strong>POST提交：</strong>把提交的数据放置在是HTTP包的包体中。上文示例中红色字体标明的就是实际的传输数据<br> <strong>因此，GET提交的数据会在地址栏中显示出来，而POST提交，地址栏不会改变</strong></p>
<p> <strong>(2)传输数据的大小</strong><br><strong>首先声明：HTTP协议没有对传输的数据大小进行限制，HTTP协议规范也没有对URL长度进行限制。</strong><br>而在实际开发中存在的限制主要有：<br><strong>GET:特定浏览器和服务器对URL长度有限制</strong>，例如IE对URL长度的限制是2083字节(2K+35)。对于其他浏览器，如Netscape、FireFox等，理论上没有长度限制，其限制取决于操作系统的支持。<br><strong>因此对于GET提交时，传输数据就会受到URL长度的限制。</strong><br>POST:由于不是通过URL传值，理论上数据不受限。但实际各个WEB服务器会规定对post提交数据大小进行限制，Apache、IIS6都有各自的配置。</p>
<p> <strong>(3)安全性：</strong><br>.POST的安全性要比GET的安全性高。<strong>注意：这里所说的安全性和上面GET提到的“安全”不是同个概念。上面“安全”的含义仅仅是不作数据修改，而这 里安全的含义是真正的Security的含义，比如：通过GET提交数据，用户名和密码将明文出现在URL上，因为(1)登录页面有可能被浏览器缓存， (2)其他人查看浏览器的历史纪录，那么别人就可以拿到你的账号和密码了，除此之外，使用GET提交数据还可能会造成Cross-site request forgery攻击</strong></p>
<p><strong>(4)Http get,post,soap协议都是在http上运行的</strong></p>
<p>1）get：请求参数是作为一个key/value对的序列（查询字符串）附加到URL上的查询字符串的长度受到web浏览器和web服务器的限制（如IE最多支持2048个字符），不适合传输大型数据集同时，它很不安全。<br>2）post：请求参数是在http标题的一个不同部分（名为entity body）传输的，这一部分用来传输表单信息，因此必须将Content-type设置为:application/x-www-form-urlencoded。post设计用来支持web窗体上的用户字段，其参数也是作为key/value对传输。但是：它不支持复杂数据类型，因为post没有定义传输数据结构的语义和规则。<br>3）soap：是http post的一个专用版本，遵循一种特殊的xml消息格式，Content-type设置为: text/xml   ，任何数据都可以xml化。</p>
<h4 id="HTTP响应"><a href="#HTTP响应" class="headerlink" title="HTTP响应"></a>HTTP响应</h4><p>1．HTTP响应格式：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">&lt;status line&gt;</div><div class="line">&lt;headers&gt;</div><div class="line">&lt;blank line&gt;</div><div class="line">[&lt;response-body&gt;]</div></pre></td></tr></table></figure></p>
<p>在响应中唯一真正的区别在于第一行中用状态信息代替了请求信息。状态行（status line）通过提供一个状态码来说明所请求的资源情况。</p>
<p>HTTP响应实例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">HTTP/1.1 200 OK</div><div class="line">Date: Sat, 31 Dec 2005 23:59:59 GMT</div><div class="line">Content-Type: text/html;charset=ISO-8859-1</div><div class="line">Content-Length: 122</div><div class="line">＜html＞</div><div class="line">＜head＞</div><div class="line">＜title＞Wrox Homepage＜/title＞</div><div class="line">＜/head＞</div><div class="line">＜body＞</div><div class="line">＜!-- body goes here --＞</div><div class="line">＜/body＞</div><div class="line">＜/html＞</div></pre></td></tr></table></figure>
<p>2．最常用的状态码有：</p>
<p>◆200 (OK): 找到了该资源，并且一切正常。<br>◆304 (NOT MODIFIED): 该资源在上次请求之后没有任何修改。这通常用于浏览器的缓存机制。<br>◆401 (UNAUTHORIZED): 客户端无权访问该资源。这通常会使得浏览器要求用户输入用户名和密码，以登录到服务器。<br>◆403 (FORBIDDEN): 客户端未能获得授权。这通常是在401之后输入了不正确的用户名或密码。<br>◆404 (NOT FOUND): 在指定的位置不存在所申请的资源。</p>
<h3 id="三、完整例子"><a href="#三、完整例子" class="headerlink" title="三、完整例子"></a>三、完整例子</h3><p><strong>HTTP GET </strong></p>
<p>发送</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">GET /DEMOWebServices2.8/Service.asmx/CancelOrder?UserID=string&amp;PWD=string&amp;OrderConfirmation=string HTTP/1.1</div><div class="line">Host: api.efxnow.com</div></pre></td></tr></table></figure>
<p>回复</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">HTTP/1.1 200 OK</div><div class="line">Content-Type: text/xml; charset=utf-8</div><div class="line">Content-Length: length</div><div class="line"></div><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;objPlaceOrderResponse xmlns=&quot;https://api.efxnow.com/webservices2.3&quot;&gt;</div><div class="line">&lt;Success&gt;boolean&lt;/Success&gt;</div><div class="line">&lt;ErrorDescription&gt;string&lt;/ErrorDescription&gt;</div><div class="line">&lt;ErrorNumber&gt;int&lt;/ErrorNumber&gt;</div><div class="line">&lt;CustomerOrderReference&gt;long&lt;/CustomerOrderReference&gt;</div><div class="line">&lt;OrderConfirmation&gt;string&lt;/OrderConfirmation&gt;</div><div class="line">&lt;CustomerDealRef&gt;string&lt;/CustomerDealRef&gt;</div><div class="line">&lt;/objPlaceOrderResponse&gt;</div></pre></td></tr></table></figure>
<p><strong><br>HTTP POST </strong></p>
<p>发送</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">POST /DEMOWebServices2.8/Service.asmx/CancelOrder HTTP/1.1</div><div class="line">Host: api.efxnow.com</div><div class="line">Content-Type: application/x-www-form-urlencoded</div><div class="line">Content-Length: length</div><div class="line"></div><div class="line">UserID=string&amp;PWD=string&amp;OrderConfirmation=string</div></pre></td></tr></table></figure>
<p>回复</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">HTTP/1.1 200 OK</div><div class="line">Content-Type: text/xml; charset=utf-8</div><div class="line">Content-Length: length</div><div class="line"></div><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;objPlaceOrderResponse xmlns=&quot;https://api.efxnow.com/webservices2.3&quot;&gt;</div><div class="line">&lt;Success&gt;boolean&lt;/Success&gt;</div><div class="line">&lt;ErrorDescription&gt;string&lt;/ErrorDescription&gt;</div><div class="line">&lt;ErrorNumber&gt;int&lt;/ErrorNumber&gt;</div><div class="line">&lt;CustomerOrderReference&gt;long&lt;/CustomerOrderReference&gt;</div><div class="line">&lt;OrderConfirmation&gt;string&lt;/OrderConfirmation&gt;</div><div class="line">&lt;CustomerDealRef&gt;string&lt;/CustomerDealRef&gt;</div><div class="line">&lt;/objPlaceOrderResponse&gt;</div></pre></td></tr></table></figure>
<p><strong>SOAP 1.2 </strong></p>
<p>发送</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">POST /DEMOWebServices2.8/Service.asmx HTTP/1.1</div><div class="line">Host: api.efxnow.com</div><div class="line">Content-Type: application/soap+xml; charset=utf-8</div><div class="line">Content-Length: length</div><div class="line"></div><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;soap12:Envelope xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot; xmlns:soap12=&quot;http://www.w3.org/2003/05/soap-envelope&quot;&gt;</div><div class="line">&lt;soap12:Body&gt;</div><div class="line">    &lt;CancelOrder xmlns=&quot;https://api.efxnow.com/webservices2.3&quot;&gt;</div><div class="line">      &lt;UserID&gt;string&lt;/UserID&gt;</div><div class="line">      &lt;PWD&gt;string&lt;/PWD&gt;</div><div class="line">      &lt;OrderConfirmation&gt;string&lt;/OrderConfirmation&gt;</div><div class="line">    &lt;/CancelOrder&gt;</div><div class="line">&lt;/soap12:Body&gt;</div><div class="line">&lt;/soap12:Envelope&gt;</div></pre></td></tr></table></figure>
<p>回复</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">HTTP/1.1 200 OK</div><div class="line">Content-Type: application/soap+xml; charset=utf-8</div><div class="line">Content-Length: length</div><div class="line"></div><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;soap12:Envelope xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot; xmlns:soap12=&quot;http://www.w3.org/2003/05/soap-envelope&quot;&gt;</div><div class="line">&lt;soap12:Body&gt;</div><div class="line">    &lt;CancelOrderResponse xmlns=&quot;https://api.efxnow.com/webservices2.3&quot;&gt;</div><div class="line">      &lt;CancelOrderResult&gt;</div><div class="line">        &lt;Success&gt;boolean&lt;/Success&gt;</div><div class="line">        &lt;ErrorDescription&gt;string&lt;/ErrorDescription&gt;</div><div class="line">        &lt;ErrorNumber&gt;int&lt;/ErrorNumber&gt;</div><div class="line">        &lt;CustomerOrderReference&gt;long&lt;/CustomerOrderReference&gt;</div><div class="line">        &lt;OrderConfirmation&gt;string&lt;/OrderConfirmation&gt;</div><div class="line">        &lt;CustomerDealRef&gt;string&lt;/CustomerDealRef&gt;</div><div class="line">      &lt;/CancelOrderResult&gt;</div><div class="line">    &lt;/CancelOrderResponse&gt;</div><div class="line">&lt;/soap12:Body&gt;</div><div class="line">&lt;/soap12:Envelope&gt;</div></pre></td></tr></table></figure>
<p>注：本文参考借鉴了：<br>Qt之高级网络操作（HTTP/FTP快速上手） <a href="http://blog.csdn.net/liang19890820/article/details/52535755" target="_blank" rel="external">http://blog.csdn.net/liang19890820/article/details/52535755</a><br>HTTP POST GET 本质区别详解 <a href="http://blog.csdn.net/mingzznet/article/details/9328153" target="_blank" rel="external">http://blog.csdn.net/mingzznet/article/details/9328153</a><br>关于http协议，一篇就够了<br><a href="http://www.cnblogs.com/ranyonsue/p/5984001.html" target="_blank" rel="external">http://www.cnblogs.com/ranyonsue/p/5984001.html</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/22/QT之json/" itemprop="url">
                  QT之json
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-04-22T11:01:10+08:00" content="2017-04-22">
              2017-04-22
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/QT/" itemprop="url" rel="index">
                    <span itemprop="name">QT</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/04/22/QT之json/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/04/22/QT之json/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>关于 Qt 中对 JSON 的生成与解析，Qt5 以前的版本，可以使用 QJson 库，需要单独下载、编译，才能使用。到了 Qt5，提供了专门的 QJsonDocument 及其相关类来读和写 JSON 文档。<br>QJson 是一个基于 Qt 的第三方库，适用于 Qt4 和 Qt5 两个版本。不过，如果你的应用仅仅需要考虑兼容 Qt5，其实已经有了内置的处理函数。Qt5 新增加了处理 JSON 的类，与 XML 类库类似，均以 QJson 开头，在 QtCore 模块中，不需要额外引入其它模块。Qt5 新增加六个相关类：<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">QJsonArray                  封装 JSON 数组</div><div class="line">QJsonDocument               读写 JSON 文档。</div><div class="line">QJsonObject                 封装 JSON 对象</div><div class="line">QJsonObject::iterator       用于遍历QJsonObject的 STL 风格的非 const 遍历器</div><div class="line">QJsonParseError             报告 JSON 处理过程中出现的错误</div><div class="line">QJsonValue                  封装 JSON 值</div></pre></td></tr></table></figure></p>
<p><strong>QJsonDocument</strong><br>一个 JSON 文档可以使用 QJsonDocument::fromJson() 从基于文本的表示转化为 QJsonDocument， toJson() 则可以反向转化为文本。解析器非常快且高效，并将 JSON 转换为 Qt 使用的二进制表示。<br>如果要查询一个 JSON 文档是否包含一个数组或一个对象，使用 isArray() 和 isObject()。包含在文档中的数组或对象可以使用 array() 或 object() 检索，然后读取或操作。也可以使用 fromBinaryData() 或 fromRawData() 从存储的二进制表示创建来 JSON 文档。<br><strong>QJsonArray</strong><br>QJsonArray 类封装了一个 JSON 数组。<br>JSON 数组是值的列表。列表可以被操作，通过从数组中插入和删除 QJsonValue 。<br>一个 QJsonArray 可以和一个 QVariantList 相互转换。可以使用 size() 来查询条目的数量，通过 insert() 在指定索引处插入值，removeAt() 来删除指定索引的值。<br><strong>QJsonObject</strong><br>QJsonObject 类封装了一个 JSON 对象。<br>一个 JSON 对象是一个“key/value 对”列表，key 是独一无二的字符串，value 由一个 QJsonValue 表示。<br>一个 QJsonObject 可以和一个 QVariantMap 相互转换。可以使用 size() 来查询“key/value 对”的数量，通过 insert() 插入“key/value 对”， remove() 删除指定的 key。<br><strong>QJsonValue</strong><br>QJsonValue 类封装了一个值。<br>JSON 中的值有 6 种基本数据类型：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">bool（QJsonValue::Bool）</div><div class="line">double（QJsonValue::Double）</div><div class="line">string（QJsonValue::String）</div><div class="line">array（QJsonValue::Array）</div><div class="line">object（QJsonValue::Object）</div><div class="line">null（QJsonValue::Null）</div></pre></td></tr></table></figure></p>
<p>一个值可以由任何上述数据类型表示。此外，QJsonValue 有一个特殊的标记来表示未定义的值，可以使用 isUndefined() 查询。<br>值的类型可以通过 type() 或 isBool()、isString() 等访问函数查询。同样地，值可以通过 toBool()、toString() 等函数转化成相应的存储类型。<br><strong>QJsonParseError</strong><br>QJsonParseError 类用于在 JSON 解析中报告错误。<br>枚举 QJsonParseError::ParseError：<br>该枚举描述 JSON 文档在解析过程中所发生的错误类型。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">常量                                      值                       描述</div><div class="line">QJsonParseError::NoError                  0                     未发生错误</div><div class="line">QJsonParseError::UnterminatedObject       1                对象不正确地终止以右花括号结束</div><div class="line">QJsonParseError::MissingNameSeparator     2                   分隔不同项的逗号丢失</div><div class="line">QJsonParseError::UnterminatedArray        3                数组不正确地终止以右中括号结束</div><div class="line">QJsonParseError::MissingValueSeparator    4               对象中分割 key/value 的冒号丢失</div><div class="line">QJsonParseError::IllegalValue             5                      值是非法的</div><div class="line">QJsonParseError::TerminationByNumber      6                在解析数字时，输入流结束</div><div class="line">QJsonParseError::IllegalNumber            7                    数字格式不正确</div><div class="line">QJsonParseError::IllegalEscapeSequence    8               在输入时，发生一个非法转义序列</div><div class="line">QJsonParseError::IllegalUTF8String        9               在输入时，发生一个非法 UTF8 序列</div><div class="line">QJsonParseError::UnterminatedString       10                  字符串不是以引号结束</div><div class="line">QJsonParseError::MissingObject            11              一个对象是预期的，但是不能被发现</div><div class="line">QJsonParseError::DeepNesting              12              对解析器来说，JSON 文档嵌套太深</div><div class="line">QJsonParseError::DocumentTooLarge         13              对解析器来说，JSON 文档太大</div><div class="line">QJsonParseError::GarbageAtEnd             14              解析的文档在末尾处包含额外的乱码</div></pre></td></tr></table></figure></p>
<h4 id="一个简单的-JSON-对象："><a href="#一个简单的-JSON-对象：" class="headerlink" title="一个简单的 JSON 对象："></a><strong>一个简单的 JSON 对象：</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    &quot;Cross Platform&quot;: true,</div><div class="line">    &quot;From&quot;: 1991,</div><div class="line">    &quot;Name&quot;: &quot;Qt&quot;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>生成</strong>比较简单，由于是一个对象，只需要用 QJsonObject 即可。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">// 构建 JSON 对象</div><div class="line">QJsonObject json;</div><div class="line">json.insert(&quot;Name&quot;, &quot;Qt&quot;);</div><div class="line">json.insert(&quot;From&quot;, 1991);</div><div class="line">json.insert(&quot;Cross Platform&quot;, true);</div><div class="line"></div><div class="line">// 构建 JSON 文档</div><div class="line">QJsonDocument document;</div><div class="line">document.setObject(json);</div><div class="line">QByteArray byteArray = document.toJson(QJsonDocument::Compact);</div><div class="line">QString strJson(byteArray);</div><div class="line"></div><div class="line">qDebug() &lt;&lt; strJson;</div></pre></td></tr></table></figure></p>
<p><strong>解析如下</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">QJsonParseError jsonError;</div><div class="line">QJsonDocument doucment = QJsonDocument::fromJson(byteArray, &amp;jsonError);  // 转化为 JSON 文档</div><div class="line">if (!doucment.isNull() &amp;&amp; (jsonError.error == QJsonParseError::NoError)) &#123;  // 解析未发生错误</div><div class="line">    if (doucment.isObject()) &#123; // JSON 文档为对象</div><div class="line">        QJsonObject object = doucment.object();  // 转化为对象</div><div class="line">        if (object.contains(&quot;Name&quot;)) &#123;  // 包含指定的 key</div><div class="line">            QJsonValue value = object.value(&quot;Name&quot;);  // 获取指定 key 对应的 value</div><div class="line">            if (value.isString()) &#123;  // 判断 value 是否为字符串</div><div class="line">                QString strName = value.toString();  // 将 value 转化为字符串</div><div class="line">                qDebug() &lt;&lt; &quot;Name : &quot; &lt;&lt; strName;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        if (object.contains(&quot;From&quot;)) &#123;</div><div class="line">            QJsonValue value = object.value(&quot;From&quot;);</div><div class="line">            if (value.isDouble()) &#123;</div><div class="line">                int nFrom = value.toVariant().toInt();</div><div class="line">                qDebug() &lt;&lt; &quot;From : &quot; &lt;&lt; nFrom;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        if (object.contains(&quot;Cross Platform&quot;)) &#123;</div><div class="line">            QJsonValue value = object.value(&quot;Cross Platform&quot;);</div><div class="line">            if (value.isBool()) &#123;</div><div class="line">                bool bCrossPlatform = value.toBool();</div><div class="line">                qDebug() &lt;&lt; &quot;CrossPlatform : &quot; &lt;&lt; bCrossPlatform;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="简单的-JSON-数组"><a href="#简单的-JSON-数组" class="headerlink" title="简单的 JSON 数组"></a><strong>简单的 JSON 数组</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[</div><div class="line">    &quot;Qt&quot;,</div><div class="line">    5.7,</div><div class="line">    true</div><div class="line">]</div></pre></td></tr></table></figure>
<p><strong>生成</strong>比较简单，由于是一个数组，只需要用 QJsonArray 即可。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">// 构建 JSON 数组</div><div class="line">QJsonArray json;</div><div class="line">json.append(&quot;Qt&quot;);</div><div class="line">json.append(5.7);</div><div class="line">json.append(true);</div><div class="line"></div><div class="line">// 构建 JSON 文档</div><div class="line">QJsonDocument document;</div><div class="line">document.setArray(json);</div><div class="line">QByteArray byteArray = document.toJson(QJsonDocument::Compact);</div><div class="line">QString strJson(byteArray);</div><div class="line"></div><div class="line">qDebug() &lt;&lt; strJson;</div></pre></td></tr></table></figure></p>
<p>需要注意的是，和上面不同的是，这里使用的是 QJsonDocument 的 setArray() 函数，因为是数组。<br><strong>解析如下：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">QJsonParseError jsonError;</div><div class="line">QJsonDocument doucment = QJsonDocument::fromJson(byteArray, &amp;jsonError);  // 转化为 JSON 文档</div><div class="line">if (!doucment.isNull() &amp;&amp; (jsonError.error == QJsonParseError::NoError)) &#123; // 解析未发生错误</div><div class="line">    if (doucment.isArray()) &#123; // JSON 文档为数组</div><div class="line">        QJsonArray array = doucment.array();  // 转化为数组</div><div class="line">        int nSize = array.size();  // 获取数组大小</div><div class="line">        for (int i = 0; i &lt; nSize; ++i) &#123;  // 遍历数组</div><div class="line">            QJsonValue value = array.at(i);</div><div class="line">            if (value.type() == QJsonValue::String) &#123;</div><div class="line">                QString strName = value.toString();</div><div class="line">                qDebug() &lt;&lt; strName;</div><div class="line">            &#125;</div><div class="line">            if (value.type() == QJsonValue::Double) &#123;</div><div class="line">                double dVersion = value.toDouble();</div><div class="line">                qDebug() &lt;&lt; dVersion;</div><div class="line">            &#125;</div><div class="line">            if (value.type() == QJsonValue::Bool) &#123;</div><div class="line">                bool bCrossPlatform  = value.toBool();</div><div class="line">                qDebug() &lt;&lt; bCrossPlatform;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>和 JSON 对象类似，在遍历数组时，获取每个 value，首先需要判断 value 的类型（和 is <em>**</em>() 函数类似，这里根据 type() 函数返回的枚举值来判断），然后再进行相应的转换。</p>
<h4 id="复杂的-JSON"><a href="#复杂的-JSON" class="headerlink" title="复杂的 JSON"></a>复杂的 JSON</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    &quot;Company&quot;: &quot;Digia&quot;,</div><div class="line">    &quot;From&quot;: 1991,</div><div class="line">    &quot;Name&quot;: &quot;Qt&quot;,</div><div class="line">    &quot;Page&quot;: &#123;</div><div class="line">        &quot;Developers&quot;: &quot;https://www.qt.io/developers/&quot;,</div><div class="line">        &quot;Download&quot;: &quot;https://www.qt.io/download/&quot;,</div><div class="line">        &quot;Home&quot;: &quot;https://www.qt.io/&quot;</div><div class="line">    &#125;,</div><div class="line">    &quot;Version&quot;: [</div><div class="line">        4.8,</div><div class="line">        5.2,</div><div class="line">        5.7</div><div class="line">    ]</div></pre></td></tr></table></figure>
<p>包含了一个拥有五个“key/value 对”的对象，values 中的两个（Company、Name）是字符串，一个（From）是数字，一个（Page）是对象，一个（Version）是数组。<br>要生成这样一个复杂的 JSON 文档，需要分别构造对象和数组，然后将它们拼接起来：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">// 构建 Json 数组 - Version</div><div class="line">QJsonArray versionArray;</div><div class="line">versionArray.append(4.8);</div><div class="line">versionArray.append(5.2);</div><div class="line">versionArray.append(5.7);</div><div class="line"></div><div class="line">// 构建 Json 对象 - Page</div><div class="line">QJsonObject pageObject;</div><div class="line">pageObject.insert(&quot;Home&quot;, &quot;https://www.qt.io/&quot;);</div><div class="line">pageObject.insert(&quot;Download&quot;, &quot;https://www.qt.io/download/&quot;);</div><div class="line">pageObject.insert(&quot;Developers&quot;, &quot;https://www.qt.io/developers/&quot;);</div><div class="line"></div><div class="line">// 构建 Json 对象</div><div class="line">QJsonObject json;</div><div class="line">json.insert(&quot;Name&quot;, &quot;Qt&quot;);</div><div class="line">json.insert(&quot;Company&quot;, &quot;Digia&quot;);</div><div class="line">json.insert(&quot;From&quot;, 1991);</div><div class="line">json.insert(&quot;Version&quot;, QJsonValue(versionArray));</div><div class="line">json.insert(&quot;Page&quot;, QJsonValue(pageObject));</div><div class="line"></div><div class="line">// 构建 Json 文档</div><div class="line">QJsonDocument document;</div><div class="line">document.setObject(json);</div><div class="line">QByteArray byteArray = document.toJson(QJsonDocument::Compact);</div><div class="line">QString strJson(byteArray);</div><div class="line"></div><div class="line">qDebug() &lt;&lt; strJson;</div></pre></td></tr></table></figure></p>
<p>解析部分其实并没有看起来这么复杂，只要一步步搞明白对应的类型，然后进行相应转化即可。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div></pre></td><td class="code"><pre><div class="line">QJsonParseError jsonError;</div><div class="line">QJsonDocument doucment = QJsonDocument::fromJson(byteArray, &amp;jsonError);  // 转化为 JSON 文档</div><div class="line">if (!doucment.isNull() &amp;&amp; (jsonError.error == QJsonParseError::NoError)) &#123;  // 解析未发生错误</div><div class="line">    if (doucment.isObject()) &#123;  // JSON 文档为对象</div><div class="line">        QJsonObject object = doucment.object();  // 转化为对象</div><div class="line">        if (object.contains(&quot;Name&quot;)) &#123;</div><div class="line">            QJsonValue value = object.value(&quot;Name&quot;);</div><div class="line">            if (value.isString()) &#123;</div><div class="line">                QString strName = value.toString();</div><div class="line">                qDebug() &lt;&lt; &quot;Name : &quot; &lt;&lt; strName;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        if (object.contains(&quot;Company&quot;)) &#123;</div><div class="line">            QJsonValue value = object.value(&quot;Company&quot;);</div><div class="line">            if (value.isString()) &#123;</div><div class="line">                QString strCompany = value.toString();</div><div class="line">                qDebug() &lt;&lt; &quot;Company : &quot; &lt;&lt; strCompany;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        if (object.contains(&quot;From&quot;)) &#123;</div><div class="line">            QJsonValue value = object.value(&quot;From&quot;);</div><div class="line">            if (value.isDouble()) &#123;</div><div class="line">                int nFrom = value.toVariant().toInt();</div><div class="line">                qDebug() &lt;&lt; &quot;From : &quot; &lt;&lt; nFrom;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        if (object.contains(&quot;Version&quot;)) &#123;</div><div class="line">            QJsonValue value = object.value(&quot;Version&quot;);</div><div class="line">            if (value.isArray()) &#123;  // Version 的 value 是数组</div><div class="line">                QJsonArray array = value.toArray();</div><div class="line">                int nSize = array.size();</div><div class="line">                for (int i = 0; i &lt; nSize; ++i) &#123;</div><div class="line">                    QJsonValue value = array.at(i);</div><div class="line">                    if (value.isDouble()) &#123;</div><div class="line">                        double dVersion = value.toDouble();</div><div class="line">                        qDebug() &lt;&lt; &quot;Version : &quot; &lt;&lt; dVersion;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        if (object.contains(&quot;Page&quot;)) &#123;</div><div class="line">            QJsonValue value = object.value(&quot;Page&quot;);</div><div class="line">            if (value.isObject()) &#123;  // Page 的 value 是对象</div><div class="line">                QJsonObject obj = value.toObject();</div><div class="line">                if (obj.contains(&quot;Home&quot;)) &#123;</div><div class="line">                    QJsonValue value = obj.value(&quot;Home&quot;);</div><div class="line">                    if (value.isString()) &#123;</div><div class="line">                        QString strHome = value.toString();</div><div class="line">                        qDebug() &lt;&lt; &quot;Home : &quot; &lt;&lt; strHome;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">                if (obj.contains(&quot;Download&quot;)) &#123;</div><div class="line">                    QJsonValue value = obj.value(&quot;Download&quot;);</div><div class="line">                    if (value.isString()) &#123;</div><div class="line">                        QString strDownload = value.toString();</div><div class="line">                        qDebug() &lt;&lt; &quot;Download : &quot; &lt;&lt; strDownload;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">                if (obj.contains(&quot;Developers&quot;)) &#123;</div><div class="line">                    QJsonValue value = obj.value(&quot;Developers&quot;);</div><div class="line">                    if (value.isString()) &#123;</div><div class="line">                        QString strDevelopers = value.toString();</div><div class="line">                        qDebug() &lt;&lt; &quot;Developers : &quot; &lt;&lt; strDevelopers;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>基本的用法就这些，比较简单，细节很关键，建议在处理的过程中启用严格模式，例如：先通过 QJsonParseError::NoError 判断转化 JSON 文档无误，再进行解析。在解析过程中，先判断 QJsonValue 是否为对应的类型如 isObject()，再通过 toObject() 转化。<br>注：本文参考了一去二三里的博客</p>
<blockquote>
<p>   Qt之JSON生成与解析 <a href="http://blog.csdn.net/liang19890820/article/details/52767153" target="_blank" rel="external">http://blog.csdn.net/liang19890820/article/details/52767153</a></p>
</blockquote>
<p>至于QT的读写文件操作 与 如何以JSON和二进制格式来保存和加载一个简单的游戏</p>
<blockquote>
<p>Qt5对Json的读写总结浅析 <a href="http://blog.csdn.net/zp1352472310/article/details/40741875" target="_blank" rel="external">http://blog.csdn.net/zp1352472310/article/details/40741875</a><br>Qt之JSON保存与读取 <a href="http://blog.csdn.net/liang19890820/article/details/52797245" target="_blank" rel="external">http://blog.csdn.net/liang19890820/article/details/52797245</a></p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="https://gss0.baidu.com/9fo3dSag_xI4khGko9WTAnF6hhy/zhidao/pic/item/3812b31bb051f8196c5029e9d8b44aed2e73e718.jpg"
               alt="shalian" />
          <p class="site-author-name" itemprop="name">shalian</p>
          <p class="site-description motion-element" itemprop="description">记录生活点滴</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">53</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">14</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">66</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/shalian123" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/u/3329000660/home?wvr=5" target="_blank" title="新浪微博">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  新浪微博
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/" target="_blank" title="知乎">
                  
                    <i class="fa fa-fw fa-pinterest"></i>
                  
                  知乎
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              友情链接
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.baidu.com/" title="百度" target="_blank">百度</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://harmansecurity.cn/" title="harman" target="_blank">harman</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.codecooler.tech/" title="DoRin" target="_blank">DoRin</a>
                </li>
              
            </ul>
          </div>
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">shalian</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.1"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"shalian"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
  





  
  
  

  

  

</body>
</html>
